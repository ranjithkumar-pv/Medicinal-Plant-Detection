<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Medicinal Plant Identifier</title>
  <style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    /* Add background image */
    background-image: url('static//bg.png'); /* Replace with your image path */
    background-size: cover;       /* Make it cover the entire page */
    background-position: center;  /* Center the image */
    background-repeat: no-repeat; /* Prevent tiling */
    background-attachment: fixed; /* Keep image fixed while scrolling */
    color: #fff;                  /* Optional: change text color for readability */
  }

    .container {
      margin-top: 50px;
    }
    .container h1 {
      color:#10da86
    }
    button, input {
      padding: 10px 15px;
      margin: 10px;
      border-radius: 8px;
      border: 1px solid #022f1c;
      font-size: 16px;
      cursor: pointer;
    }
    #image-container {
      position: relative;
      width: 400px;
      height: 400px;
      margin: 20px auto;
      border: 2px solid #ccc;
      border-radius: 10px;
      overflow: hidden;
      background: white;
      transition: opacity 0.8s ease;
    }
    #image-container img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
      transition: opacity 0.8s ease;
    }
    .scanner {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(to bottom, rgba(0,255,0,0) 0%, rgba(73, 201, 73, 0.5) 50%, rgba(0,255,0,0) 100%);
      animation: scan 2s linear infinite;
      pointer-events: none;
      transition: opacity 0.8s ease;
    }
    @keyframes scan {
      0% { top: 0; }
      100% { top: 395px; }
    }
    #result img {
      max-width: 400px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      margin-top: 10px;
    }
    .fade-out { opacity: 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>
      <span style="color: rgb(20, 175, 20);">Medicinal Plant</span>
      <span style="color: white;"> Identifier</span>
    </h1>
    <p>Use camera or upload an leaf image to identify a plant</p>

    <!-- Camera Capture -->
    <button onclick="openCamera()">Camera</button>
    <video id="camera" autoplay style="display:none; width:400px; margin-top:20px;"></video>
    <canvas id="snapshot" style="display:none;"></canvas>

    <!-- Upload Input -->
    <form id="uploadForm" enctype="multipart/form-data">
      <input type="file" name="image" accept="image/*">
      <button type="submit">Get Plant</button>
    </form>

    <!-- Image Preview + Scanner -->
    <div id="image-container" style="display:none;">
      <img id="preview" src="">
      <div class="scanner" id="scanner"></div>
    </div>

    <!-- Result -->
    <div id="result"></div>
  </div>

  <script>
    // Open Camera
    function openCamera() {
      let video = document.getElementById("camera");
      video.style.display = "block";
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => { video.srcObject = stream; })
        .catch(err => { alert("Camera not available: " + err); });
    }

    // Handle Upload Prediction
    document.getElementById("uploadForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      let file = this.elements["image"].files[0];
      if (!file) return alert("Please select an image!");

      let preview = document.getElementById("preview");
      let container = document.getElementById("image-container");
      let scanner = document.getElementById("scanner");

      container.style.display = "block";
      container.style.opacity = "1";
      preview.src = URL.createObjectURL(file);
      preview.classList.remove("fade-out");
      scanner.style.opacity = "1";

      await new Promise(res => setTimeout(res, 500)); // scanner effect delay

      // Send to backend
      let formData = new FormData();
      formData.append("image", file);
      let response = await fetch("/predict", { method: "POST", body: formData });
      let data = await response.json();

      // Fade out preview + scanner
      preview.classList.add("fade-out");
      scanner.classList.add("fade-out");
      setTimeout(() => { container.style.display = "none"; }, 800);

      // âœ… Show actual plant image from backend
      document.getElementById("result").innerHTML = `
        <h2>${data.plant}</h2>
        <img src="${data.image_url}" alt="${data.plant}" />
        <br><button onclick="getDetails('${data.plant}')">More Details</button>
      `;
    });

    // Fetch Details
    async function getDetails(name) {
      let response = await fetch(`/details?name=${name}`);
      let data = await response.json();
      document.getElementById("result").innerHTML += `
        <p><b>Scientific Name:</b> ${data.scientific_name}</p>
        <p><b>Usage:</b> ${data.usage}</p>
      `;
    }
  </script>
</body>
</html>
